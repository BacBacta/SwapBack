{
  "version": "0.1.0",
  "name": "swapback_router",
  "instructions": [
    {
      "name": "initialize",
      "accounts": [
        {
          "name": "state",
          "isMut": true,
          "isSigner": false
        },
        {
          "name": "authority",
          "isMut": true,
          "isSigner": true
        },
        {
          "name": "systemProgram",
          "isMut": false,
          "isSigner": false
        }
      ],
      "args": []
    },
    {
      "name": "createPlan",
      "accounts": [
        {
          "name": "plan",
          "isMut": true,
          "isSigner": false
        },
        {
          "name": "user",
          "isMut": true,
          "isSigner": true
        },
        {
          "name": "systemProgram",
          "isMut": false,
          "isSigner": false
        }
      ],
      "args": [
        {
          "name": "planId",
          "type": {
            "array": [
              "u8",
              32
            ]
          }
        },
        {
          "name": "planData",
          "type": {
            "defined": "CreatePlanArgs"
          }
        }
      ]
    },
    {
      "name": "swapToc",
      "accounts": [
        {
          "name": "user",
          "isMut": true,
          "isSigner": true
        },
        {
          "name": "oracle",
          "isMut": false,
          "isSigner": false
        },
        {
          "name": "userTokenAccountA",
          "isMut": true,
          "isSigner": false
        },
        {
          "name": "userTokenAccountB",
          "isMut": true,
          "isSigner": false
        },
        {
          "name": "vaultTokenAccountA",
          "isMut": true,
          "isSigner": false
        },
        {
          "name": "vaultTokenAccountB",
          "isMut": true,
          "isSigner": false
        },
        {
          "name": "plan",
          "isMut": false,
          "isSigner": false
        },
        {
          "name": "userNft",
          "isMut": false,
          "isSigner": false
        },
        {
          "name": "buybackProgram",
          "isMut": false,
          "isSigner": false
        },
        {
          "name": "buybackUsdcVault",
          "isMut": true,
          "isSigner": false
        },
        {
          "name": "buybackState",
          "isMut": true,
          "isSigner": false
        },
        {
          "name": "userRebateAccount",
          "isMut": true,
          "isSigner": false
        },
        {
          "name": "tokenProgram",
          "isMut": false,
          "isSigner": false
        },
        {
          "name": "systemProgram",
          "isMut": false,
          "isSigner": false
        }
      ],
      "args": [
        {
          "name": "args",
          "type": {
            "defined": "SwapArgs"
          }
        }
      ]
    }
  ],
  "accounts": [
    {
      "name": "RouterState",
      "type": {
        "kind": "struct",
        "fields": [
          {
            "name": "authority",
            "type": "publicKey"
          },
          {
            "name": "bump",
            "type": "u8"
          }
        ]
      }
    },
    {
      "name": "SwapPlan",
      "type": {
        "kind": "struct",
        "fields": [
          {
            "name": "planId",
            "type": {
              "array": [
                "u8",
                32
              ]
            }
          },
          {
            "name": "user",
            "type": "publicKey"
          },
          {
            "name": "tokenIn",
            "type": "publicKey"
          },
          {
            "name": "tokenOut",
            "type": "publicKey"
          },
          {
            "name": "amountIn",
            "type": "u64"
          },
          {
            "name": "minOut",
            "type": "u64"
          },
          {
            "name": "venues",
            "type": {
              "vec": {
                "defined": "VenueWeight"
              }
            }
          },
          {
            "name": "fallbackPlans",
            "type": {
              "vec": {
                "defined": "FallbackPlan"
              }
            }
          },
          {
            "name": "expiresAt",
            "type": "i64"
          },
          {
            "name": "createdAt",
            "type": "i64"
          },
          {
            "name": "bump",
            "type": "u8"
          }
        ]
      }
    },
    {
      "name": "UserNft",
      "type": {
        "kind": "struct",
        "fields": [
          {
            "name": "user",
            "type": "publicKey"
          },
          {
            "name": "level",
            "type": {
              "defined": "LockLevel"
            }
          },
          {
            "name": "amountLocked",
            "type": "u64"
          },
          {
            "name": "lockDuration",
            "type": "i64"
          },
          {
            "name": "boost",
            "type": "u16"
          },
          {
            "name": "mintTime",
            "type": "i64"
          },
          {
            "name": "isActive",
            "type": "bool"
          }
        ]
      }
    }
  ],
  "types": [
    {
      "name": "CreatePlanArgs",
      "type": {
        "kind": "struct",
        "fields": [
          {
            "name": "planId",
            "type": {
              "array": [
                "u8",
                32
              ]
            }
          },
          {
            "name": "tokenIn",
            "type": "publicKey"
          },
          {
            "name": "tokenOut",
            "type": "publicKey"
          },
          {
            "name": "amountIn",
            "type": "u64"
          },
          {
            "name": "minOut",
            "type": "u64"
          },
          {
            "name": "venues",
            "type": {
              "vec": {
                "defined": "VenueWeight"
              }
            }
          },
          {
            "name": "fallbackPlans",
            "type": {
              "vec": {
                "defined": "FallbackPlan"
              }
            }
          },
          {
            "name": "expiresAt",
            "type": "i64"
          }
        ]
      }
    },
    {
      "name": "SwapArgs",
      "type": {
        "kind": "struct",
        "fields": [
          {
            "name": "amountIn",
            "type": "u64"
          },
          {
            "name": "minOut",
            "type": "u64"
          },
          {
            "name": "slippageTolerance",
            "type": {
              "option": "u16"
            }
          },
          {
            "name": "twapSlices",
            "type": {
              "option": "u8"
            }
          },
          {
            "name": "useDynamicPlan",
            "type": "bool"
          },
          {
            "name": "planAccount",
            "type": {
              "option": "publicKey"
            }
          },
          {
            "name": "useBundle",
            "type": "bool"
          },
          {
            "name": "oracleAccount",
            "type": "publicKey"
          }
        ]
      }
    },
    {
      "name": "VenueWeight",
      "type": {
        "kind": "struct",
        "fields": [
          {
            "name": "venue",
            "type": "publicKey"
          },
          {
            "name": "weight",
            "type": "u16"
          }
        ]
      }
    },
    {
      "name": "FallbackPlan",
      "type": {
        "kind": "struct",
        "fields": [
          {
            "name": "venues",
            "type": {
              "vec": {
                "defined": "VenueWeight"
              }
            }
          },
          {
            "name": "minOut",
            "type": "u64"
          }
        ]
      }
    },
    {
      "name": "OracleType",
      "type": {
        "kind": "enum",
        "variants": [
          {
            "name": "Switchboard"
          },
          {
            "name": "Pyth"
          }
        ]
      }
    },
    {
      "name": "LockLevel",
      "type": {
        "kind": "enum",
        "variants": [
          {
            "name": "Bronze"
          },
          {
            "name": "Silver"
          },
          {
            "name": "Gold"
          },
          {
            "name": "Platinum"
          },
          {
            "name": "Diamond"
          }
        ]
      }
    }
  ],
  "events": [
    {
      "name": "OracleChecked",
      "fields": [
        {
          "name": "feed",
          "type": "publicKey",
          "index": false
        },
        {
          "name": "price",
          "type": "u64",
          "index": false
        },
        {
          "name": "confidence",
          "type": "u64",
          "index": false
        },
        {
          "name": "slot",
          "type": "u64",
          "index": false
        },
        {
          "name": "timestamp",
          "type": "i64",
          "index": false
        },
        {
          "name": "oracleType",
          "type": {
            "defined": "OracleType"
          },
          "index": false
        }
      ]
    },
    {
      "name": "VenueExecuted",
      "fields": [
        {
          "name": "venue",
          "type": "publicKey",
          "index": false
        },
        {
          "name": "amountIn",
          "type": "u64",
          "index": false
        },
        {
          "name": "amountOut",
          "type": "u64",
          "index": false
        },
        {
          "name": "success",
          "type": "bool",
          "index": false
        },
        {
          "name": "fallbackUsed",
          "type": "bool",
          "index": false
        }
      ]
    },
    {
      "name": "FallbackTriggered",
      "fields": [
        {
          "name": "planIndex",
          "type": "u8",
          "index": false
        },
        {
          "name": "reason",
          "type": "string",
          "index": false
        }
      ]
    },
    {
      "name": "BundleHint",
      "fields": [
        {
          "name": "priorityFee",
          "type": "u64",
          "index": false
        },
        {
          "name": "nInstructions",
          "type": "u8",
          "index": false
        }
      ]
    },
    {
      "name": "PriorityFeeSet",
      "fields": [
        {
          "name": "computeUnitLimit",
          "type": "u32",
          "index": false
        },
        {
          "name": "computeUnitPrice",
          "type": "u64",
          "index": false
        }
      ]
    },
    {
      "name": "SwapCompleted",
      "fields": [
        {
          "name": "user",
          "type": "publicKey",
          "index": false
        },
        {
          "name": "amountIn",
          "type": "u64",
          "index": false
        },
        {
          "name": "amountOut",
          "type": "u64",
          "index": false
        },
        {
          "name": "platformFee",
          "type": "u64",
          "index": false
        },
        {
          "name": "routingProfit",
          "type": "u64",
          "index": false
        },
        {
          "name": "buybackDeposit",
          "type": "u64",
          "index": false
        },
        {
          "name": "userBoost",
          "type": "u16",
          "index": false
        },
        {
          "name": "rebateAmount",
          "type": "u64",
          "index": false
        }
      ]
    },
    {
      "name": "RebatePaid",
      "fields": [
        {
          "name": "user",
          "type": "publicKey",
          "index": false
        },
        {
          "name": "baseRebate",
          "type": "u64",
          "index": false
        },
        {
          "name": "boost",
          "type": "u16",
          "index": false
        },
        {
          "name": "totalRebate",
          "type": "u64",
          "index": false
        },
        {
          "name": "timestamp",
          "type": "i64",
          "index": false
        }
      ]
    },
    {
      "name": "BuybackDeposit",
      "fields": [
        {
          "name": "amount",
          "type": "u64",
          "index": false
        },
        {
          "name": "source",
          "type": "string",
          "index": false
        },
        {
          "name": "timestamp",
          "type": "i64",
          "index": false
        }
      ]
    }
  ],
  "errors": [
    {
      "code": 6000,
      "name": "SlippageExceeded",
      "msg": "Slippage tolerance exceeded"
    },
    {
      "code": 6001,
      "name": "StaleOracleData",
      "msg": "Oracle price data is stale"
    },
    {
      "code": 6002,
      "name": "InvalidOraclePrice",
      "msg": "Invalid oracle price"
    },
    {
      "code": 6003,
      "name": "TwapSliceTooSmall",
      "msg": "TWAP slice amount too small"
    },
    {
      "code": 6004,
      "name": "PlanExpired",
      "msg": "Swap plan has expired"
    },
    {
      "code": 6005,
      "name": "InvalidPlanWeights",
      "msg": "Invalid plan weights - must sum to 10000"
    },
    {
      "code": 6006,
      "name": "PlanAmountMismatch",
      "msg": "Plan amount mismatch"
    },
    {
      "code": 6007,
      "name": "UnauthorizedPlanAccess",
      "msg": "Unauthorized access to swap plan"
    },
    {
      "code": 6008,
      "name": "UnknownDex",
      "msg": "Unknown DEX or not yet implemented"
    },
    {
      "code": 6009,
      "name": "InvalidTokenAccount",
      "msg": "Invalid token account"
    },
    {
      "code": 6010,
      "name": "DexNotImplemented",
      "msg": "DEX not implemented"
    },
    {
      "code": 6011,
      "name": "DexExecutionFailed",
      "msg": "DEX execution failed"
    },
    {
      "code": 6012,
      "name": "InvalidAmount",
      "msg": "Invalid amount - must be greater than 0"
    },
    {
      "code": 6013,
      "name": "SlippageTooHigh",
      "msg": "Slippage tolerance too high - max 10%"
    }
  ],
  "metadata": {
    "address": "3Z295H9QHByYn9sHm3tH7ASHitwd2Y4AEaXUddfhQKap"
  }
}
