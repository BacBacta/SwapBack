# üöÄ Guide de D√©ploiement Vercel - SwapBack

Guide complet pour d√©ployer SwapBack sur Vercel et tester avec donn√©es r√©elles Jupiter.

---

## üìã Pr√©-requis

- [x] Code committ√© sur GitHub (‚úÖ fait)
- [x] Repository accessible: https://github.com/BacBacta/SwapBack
- [x] Compte Vercel (cr√©er sur https://vercel.com si n√©cessaire)

---

## üéØ Option 1: D√©ploiement via CLI (Recommand√©)

### √âtape 1: Installer Vercel CLI

```bash
cd /workspaces/SwapBack/app
npm install -g vercel
```

### √âtape 2: Login Vercel

```bash
vercel login
```

Suivre les instructions (email ou GitHub).

### √âtape 3: D√©ployer en Preview

```bash
vercel deploy
```

**R√©pondre aux questions**:
- `Set up and deploy?` ‚Üí **Y**
- `Which scope?` ‚Üí S√©lectionner votre compte
- `Link to existing project?` ‚Üí **N** (premi√®re fois)
- `What's your project's name?` ‚Üí **swapback** (ou autre)
- `In which directory is your code located?` ‚Üí **./** (default)

**R√©sultat attendu**:
```
‚úÖ Production: https://swapback-abc123.vercel.app
```

### √âtape 4: Configurer les Variables d'Environnement

**Via CLI**:
```bash
# Jupiter API
vercel env add JUPITER_API_URL
# Entrer: https://quote-api.jup.ag/v6

# Mock Quotes (false pour production)
vercel env add USE_MOCK_QUOTES
# Entrer: false

# Network
vercel env add NEXT_PUBLIC_SOLANA_NETWORK
# Entrer: testnet

# RPC
vercel env add NEXT_PUBLIC_SOLANA_RPC_URL
# Entrer: https://api.testnet.solana.com

# Program IDs
vercel env add NEXT_PUBLIC_ROUTER_PROGRAM_ID
# Entrer: GTNyqcgqKHRu3o636WkrZfF6EjJu1KP62Bqdo52t3cgt

vercel env add NEXT_PUBLIC_BUYBACK_PROGRAM_ID
# Entrer: EoVjmALZdkU3N9uehxVV4n9C6ukRa8QrbZRMHKBD2KUf

vercel env add NEXT_PUBLIC_CNFT_PROGRAM_ID
# Entrer: 9MjuF4Vj4pZeHJejsQtzmo9wTdkjJfa9FbJRSLxHFezw

# Tokens
vercel env add NEXT_PUBLIC_BACK_MINT
# Entrer: 862PQyzjqhN4ztaqLC4kozwZCUTug7DRz1oyiuQYn7Ux

vercel env add NEXT_PUBLIC_USDC_MINT
# Entrer: BinixfcasoPdEQyV1tGw9BJ7Ar3ujoZe8MqDtTyDPEvR

# Fees
vercel env add NEXT_PUBLIC_PLATFORM_FEE_PERCENT
# Entrer: 0.20
```

### √âtape 5: Red√©ployer avec Variables

```bash
vercel deploy --prod
```

### √âtape 6: Tester l'API

```bash
# Remplacer YOUR-URL par l'URL Vercel
curl -X POST https://YOUR-URL.vercel.app/api/swap/quote \
  -H "Content-Type: application/json" \
  -d '{
    "inputMint": "So11111111111111111111111111111111111111112",
    "outputMint": "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",
    "amount": 1000000000,
    "slippageBps": 50
  }'
```

**R√©sultat attendu**:
```json
{
  "success": true,
  "quote": {
    "inputMint": "So11...",
    "outputMint": "EPj...",
    "inAmount": "1000000000",
    "outAmount": "...",
    "priceImpactPct": 0.01,
    "routePlan": [...]
  }
}
```

‚ö†Ô∏è **PAS** de `"_isMockData": true` (sinon c'est encore du MOCK)

---

## üéØ Option 2: D√©ploiement via Dashboard Vercel

### √âtape 1: Aller sur Vercel

Ouvrir: https://vercel.com/dashboard

### √âtape 2: Import Project

1. Cliquer **"Add New..."** ‚Üí **"Project"**
2. S√©lectionner **"Import Git Repository"**
3. Choisir **GitHub**
4. Autoriser Vercel √† acc√©der √† GitHub
5. S√©lectionner le repository **BacBacta/SwapBack**

### √âtape 3: Configurer le Projet

**Framework Preset**: Next.js  
**Root Directory**: `app`  
**Build Command**: `npm run build`  
**Output Directory**: `.next`

### √âtape 4: Variables d'Environnement

Dans "Environment Variables", ajouter:

| Key | Value | Environment |
|-----|-------|-------------|
| `JUPITER_API_URL` | `https://quote-api.jup.ag/v6` | Production |
| `USE_MOCK_QUOTES` | `false` | Production |
| `NEXT_PUBLIC_SOLANA_NETWORK` | `testnet` | Production |
| `NEXT_PUBLIC_SOLANA_RPC_URL` | `https://api.testnet.solana.com` | Production |
| `NEXT_PUBLIC_ROUTER_PROGRAM_ID` | `GTNyqcgqKHRu3o636WkrZfF6EjJu1KP62Bqdo52t3cgt` | Production |
| `NEXT_PUBLIC_BUYBACK_PROGRAM_ID` | `EoVjmALZdkU3N9uehxVV4n9C6ukRa8QrbZRMHKBD2KUf` | Production |
| `NEXT_PUBLIC_CNFT_PROGRAM_ID` | `9MjuF4Vj4pZeHJejsQtzmo9wTdkjJfa9FbJRSLxHFezw` | Production |
| `NEXT_PUBLIC_BACK_MINT` | `862PQyzjqhN4ztaqLC4kozwZCUTug7DRz1oyiuQYn7Ux` | Production |
| `NEXT_PUBLIC_USDC_MINT` | `BinixfcasoPdEQyV1tGw9BJ7Ar3ujoZe8MqDtTyDPEvR` | Production |
| `NEXT_PUBLIC_PLATFORM_FEE_PERCENT` | `0.20` | Production |

### √âtape 5: D√©ployer

Cliquer **"Deploy"**

Attendre ~2-3 minutes pour le build.

### √âtape 6: R√©cup√©rer l'URL

Une fois d√©ploy√©, Vercel affiche:
```
üéâ Your project is live!
https://swapback-xyz.vercel.app
```

---

## üß™ Tests Post-D√©ploiement

### Test 1: V√©rifier que le site charge

Ouvrir l'URL Vercel dans un navigateur:
```
https://YOUR-URL.vercel.app
```

**Attendu**: Interface SwapBack s'affiche

### Test 2: V√©rifier les Variables d'Environnement

Ouvrir la console du navigateur et v√©rifier:
```javascript
console.log(process.env.NEXT_PUBLIC_SOLANA_NETWORK)
// Devrait afficher: testnet
```

### Test 3: Tester l'API Quote

**Via navigateur** (ouvrir la console):
```javascript
fetch('https://YOUR-URL.vercel.app/api/swap/quote', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    inputMint: 'So11111111111111111111111111111111111111112',
    outputMint: 'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v',
    amount: 1000000000,
    slippageBps: 50
  })
})
.then(r => r.json())
.then(console.log)
```

**Ou via curl**:
```bash
curl -X POST https://YOUR-URL.vercel.app/api/swap/quote \
  -H "Content-Type: application/json" \
  -d '{
    "inputMint": "So11111111111111111111111111111111111111112",
    "outputMint": "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",
    "amount": 1000000000,
    "slippageBps": 50
  }' | jq
```

### Test 4: Tester via l'Interface

1. Ouvrir https://YOUR-URL.vercel.app
2. Connecter un wallet testnet
3. S√©lectionner SOL ‚Üí USDC
4. Entrer un montant (ex: 1 SOL)
5. Cliquer **"üîç Search Route"**

**V√©rifier**:
- ‚úÖ Bouton passe √† "Finding Best Route..."
- ‚úÖ Apr√®s ~2-3 secondes, affiche un quote
- ‚úÖ `Output Amount` non vide
- ‚úÖ Aucune erreur dans la console

### Test 5: V√©rifier les Logs Vercel

**Via Dashboard**:
1. Aller sur https://vercel.com/dashboard
2. S√©lectionner le projet SwapBack
3. Onglet **"Logs"**
4. Filtrer par `/api/swap/quote`

**Via CLI**:
```bash
vercel logs https://YOUR-URL.vercel.app --follow
```

**Chercher**:
```
‚úÖ "Fetching Jupiter quote"
‚úÖ "Quote fetched successfully"
‚ùå AUCUNE erreur "ENOTFOUND" ou "fetch failed"
```

---

## üö® R√©solution de Probl√®mes

### Probl√®me 1: "ENOTFOUND quote-api.jup.ag"

**Sympt√¥me**: M√™me erreur que dans Codespaces

**Cause**: Variable `USE_MOCK_QUOTES` encore √† `true`

**Solution**:
```bash
vercel env rm USE_MOCK_QUOTES
vercel env add USE_MOCK_QUOTES
# Entrer: false (pas true!)

vercel deploy --prod
```

### Probl√®me 2: "_isMockData: true" dans la r√©ponse

**Sympt√¥me**: L'API retourne toujours des donn√©es MOCK

**Cause**: `USE_MOCK_QUOTES` pas d√©fini ou √† `true`

**Solution**:
```bash
# V√©rifier la valeur
vercel env ls

# Si absent ou true:
vercel env add USE_MOCK_QUOTES
# Entrer: false

vercel deploy --prod
```

### Probl√®me 3: Erreur "No liquidity"

**Sympt√¥me**: Jupiter retourne une erreur

**Cause**: Token testnet non support√© par Jupiter (normal)

**Solution**: Tester avec tokens mainnet:

```json
{
  "inputMint": "So11111111111111111111111111111111111111112",
  "outputMint": "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",
  "amount": 1000000000
}
```

**Ou** garder `USE_MOCK_QUOTES=true` pour testnet.

### Probl√®me 4: Build √©choue

**Sympt√¥me**: Vercel build fails

**Logs possibles**:
```
Error: Cannot find module 'xyz'
```

**Solution**:
```bash
# Localement, v√©rifier les d√©pendances
cd /workspaces/SwapBack/app
npm install
npm run build

# Si √ßa marche localement:
git add .
git commit -m "fix: dependencies"
git push origin main

# Vercel red√©ploiera automatiquement
```

### Probl√®me 5: Variables d'environnement non charg√©es

**Sympt√¥me**: `undefined` dans le code

**Cause**: Variables pas pr√©fix√©es `NEXT_PUBLIC_` c√¥t√© client

**Rappel**:
- `JUPITER_API_URL` ‚Üí Serveur uniquement
- `USE_MOCK_QUOTES` ‚Üí Serveur uniquement
- `NEXT_PUBLIC_*` ‚Üí Disponible c√¥t√© client

**Solution**: V√©rifier que seules les variables `NEXT_PUBLIC_*` sont utilis√©es c√¥t√© client.

---

## üìä Checklist de Validation

### Avant D√©ploiement

- [x] Code committ√© sur GitHub
- [x] Tests locaux passent (MOCK)
- [x] `vercel.json` configur√©
- [x] Variables d'environnement list√©es

### Apr√®s D√©ploiement

- [ ] Site accessible via URL Vercel
- [ ] Page d'accueil se charge
- [ ] Wallet se connecte
- [ ] API `/api/swap/quote` r√©pond HTTP 200
- [ ] R√©ponse contient `success: true`
- [ ] **PAS** de `_isMockData: true`
- [ ] Quote contient `inAmount`, `outAmount`, `priceImpactPct`
- [ ] Bouton "Search Route" fonctionne
- [ ] Output amount s'affiche correctement
- [ ] Aucune erreur dans console navigateur
- [ ] Aucune erreur dans logs Vercel

---

## üéØ Sc√©narios de Test D√©taill√©s

### Sc√©nario 1: SOL ‚Üí USDC (Mainnet Tokens)

**Configuration**:
```env
USE_MOCK_QUOTES=false
NEXT_PUBLIC_SOLANA_NETWORK=testnet
```

**Requ√™te**:
```json
{
  "inputMint": "So11111111111111111111111111111111111111112",
  "outputMint": "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",
  "amount": 1000000000
}
```

**Attendu**: ‚úÖ Quote valide (Jupiter supporte ces tokens mainnet)

### Sc√©nario 2: SOL ‚Üí USDC (Testnet Token)

**Configuration**:
```env
USE_MOCK_QUOTES=false
NEXT_PUBLIC_SOLANA_NETWORK=testnet
```

**Requ√™te**:
```json
{
  "inputMint": "So11111111111111111111111111111111111111112",
  "outputMint": "BinixfcasoPdEQyV1tGw9BJ7Ar3ujoZe8MqDtTyDPEvR",
  "amount": 1000000000
}
```

**Attendu**: ‚ùå Probablement erreur "Token not found" (Jupiter ne conna√Æt pas ce token testnet)

**Solution**: Utiliser `USE_MOCK_QUOTES=true` pour testnet.

### Sc√©nario 3: Configuration Recommand√©e Testnet

**Pour garder testnet + donn√©es r√©alistes**:

```env
USE_MOCK_QUOTES=true
NEXT_PUBLIC_SOLANA_NETWORK=testnet
NEXT_PUBLIC_USDC_MINT=BinixfcasoPdEQyV1tGw9BJ7Ar3ujoZe8MqDtTyDPEvR
```

**R√©sultat**: Donn√©es simul√©es r√©alistes pour d√©veloppement testnet

### Sc√©nario 4: Configuration Production Mainnet

**Pour production avec vraies donn√©es**:

```env
USE_MOCK_QUOTES=false
NEXT_PUBLIC_SOLANA_NETWORK=mainnet-beta
NEXT_PUBLIC_SOLANA_RPC_URL=https://api.mainnet-beta.solana.com
NEXT_PUBLIC_USDC_MINT=EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v
```

---

## üìà Monitoring Post-D√©ploiement

### Logs en Temps R√©el

```bash
vercel logs --follow
```

### M√©triques Vercel

Dashboard ‚Üí Analytics:
- Requests per minute
- Error rate
- Response time
- Bandwidth

### Alerts

Configurer dans Vercel Dashboard ‚Üí Settings ‚Üí Notifications:
- ‚úÖ Deployment failed
- ‚úÖ Build errors
- ‚úÖ High error rate

---

## üîÑ Workflow de D√©veloppement

### D√©veloppement Local

```bash
# Codespaces ou local
cd /workspaces/SwapBack/app

# Utiliser MOCK pour testnet
echo "USE_MOCK_QUOTES=true" > .env.local

npm run dev
```

### Preview sur Vercel

```bash
# Tester avant production
vercel deploy

# Tester l'URL preview
curl https://swapback-preview-abc.vercel.app/api/swap/quote ...
```

### Production

```bash
# Quand tout est valid√©
vercel deploy --prod
```

---

## üìö Ressources

### Documentation

- Vercel CLI: https://vercel.com/docs/cli
- Next.js Deployment: https://nextjs.org/docs/deployment
- Jupiter API: https://station.jup.ag/docs/apis/swap-api

### Support

- Vercel Support: https://vercel.com/support
- SwapBack GitHub: https://github.com/BacBacta/SwapBack/issues

---

## ‚úÖ Commandes Rapides

### Installation

```bash
npm install -g vercel
```

### D√©ploiement

```bash
cd /workspaces/SwapBack/app
vercel login
vercel deploy --prod
```

### Test API

```bash
curl -X POST https://YOUR-URL.vercel.app/api/swap/quote \
  -H "Content-Type: application/json" \
  -d '{"inputMint":"So11111111111111111111111111111111111111112","outputMint":"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v","amount":1000000000,"slippageBps":50}' | jq
```

### Logs

```bash
vercel logs --follow
```

### Variables d'environnement

```bash
# Lister
vercel env ls

# Ajouter
vercel env add VARIABLE_NAME

# Supprimer
vercel env rm VARIABLE_NAME
```

---

**Status**: üü¢ Pr√™t pour d√©ploiement  
**Temps estim√©**: 10 minutes  
**Difficult√©**: Facile
